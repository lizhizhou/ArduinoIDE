<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="js/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>
<title>Editor</title>
  <style type="text/css" media="screen">

    .ace_editor {
        position: relative !important;
        border: 1px solid lightgray;
        margin: 0;
        height: 600px;
        width: 100%;
    }

    .ace_editor.fullScreen {
        height: auto;
        width: auto;
        border: 0;
        margin: 0;
        position: fixed !important;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 10;
        background: white;
    }

    .fullScreen {
        overflow: hidden
    }

    .scrollmargin {
	height: inherit;
	text-align: left;
    }

</style>
</head>
<body>
<img id=broadpic src="" alt="">
<div id="IDE" class="">
  <span onclick="run()" class="btn btn-success" title="run the program">
    run
  </span>
  <span onclick="stop()" class="btn btn-warning" title="stop the progrtam">
    stop
  </span>
  <a href="#myModal" role="button" class="btn btn-info" data-toggle="modal">API DOC</a>
  <span onclick="reboot()" class="btn btn-danger" title="reboot the broad">
    reboot
  </span>
  <span>
  <div class="btn-group">
<button type="button" class="btn btn-primary">
Configrations
</button>
<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
    <span class="caret"></span>
</button>
  <ul id=version_list class="dropdown-menu" role="menu">

    <li><a href="#" onClick= configrations(event)>PWM</a></li>
    <li><a href="#" onClick= configrations(event)>Analog</a></li>
  </ul>
</div>
</span>
<pre id="editor">
int main(int argn, char* argv[])
{
	printf("lophilo\n");
	return 0;
}
</pre>
<span onclick="ex1()" class="btn btn-info">
    ex1
</span>
<span onclick="ex2()" class="btn btn-info">
    ex2
</span>
<span onclick="ex3()" class="btn btn-info">
    ex3
</span>
<span onclick="ex4()" class="btn btn-info">
    ex4
</span>
<span onclick="ex5()" class="btn btn-info">
    ex5
</span>
<span onclick="ex6()" class="btn btn-info">
    ex6
</span>
<span onclick="ex7()" class="btn btn-info">
    ex7
</span>
</div>

<div class="panel panel-default">
<span onclick="clean_error()" class="btn btn-warning" title="clear the error log">
    Clear error
	</span>
<div class="panel-heading">
    <a data-toggle="collapse" data-parent="#accordion" href="#error">
    <div class="alert alert-error" role="alert"><b>Error</b>
    </div>
    </a>
</div>
<div id="error" class="panel-collapse collapse in">
  </div>
</div>
</div>
<div>

<div class="panel panel-default">
<span onclick="clean_console()" class="btn btn-warning" title="clear the console log">
    Clear console
	</span>
<div class="panel-heading">
    <a data-toggle="collapse" data-parent="#accordion" href="#console">
    <div class="alert alert-info" role="alert"><b>Console</b>
    </div>
    </a>
</div>
<div id="console" class="panel-collapse collapse in">
  </div>
</div>
</div>
<div>


<script src="./ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var debug = true;
	function debuginf(string) {
		if (debug == true) {
			console.log(string);
		}
	}
	function ajax_rest_post(url, arg) {
		var xhr = new XMLHttpRequest();
		var post;
		xhr.open("post",url,false);
		xhr.setRequestHeader( "Content-Type", "application/x-www-form-urlencoded")
		if (arg != undefined) 
			post = encodeURIComponent("text") + "=" + encodeURIComponent(arg) + "&";
		else
			post = null;
		xhr.send(post);
		debuginf(xhr.status);	
	}

	var dom = require("ace/lib/dom");
	
	//add command to all new editor instaces
	require("ace/commands/default_commands").commands.push({
		name: "Toggle Fullscreen",
		bindKey: "F11",
		exec: function(editor) {
			dom.toggleCssClass(document.body, "fullScreen")
			dom.toggleCssClass(editor.container, "fullScreen")
			editor.resize()
		}
	})
	
	// create first editor
	var editor = ace.edit("editor");
	editor.setTheme("ace/theme/tomorrow");
	editor.session.setMode("ace/mode/c_cpp");
	

	// event handle for webpage
	function configrations(event){
		version = event.srcElement.innerText;
		document.getElementById('broadpic').src = 'config/'+version+'.jpg';
		debuginf("configrations");
		debuginf(version);
		ajax_rest_post("config",version);

	}
	function run() {
		var code = editor.getValue();
		debuginf("run");
		debuginf(code);
		ajax_rest_post("run",code);
	}
	
	function stop() {
		debuginf("stop");
		ajax_rest_post("stop");
	}
	
	function reboot() {
		debuginf("reboot");
		ajax_rest_post("reboot");
	}
	
	function ex1() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255,255,255);\n"+
		"    led(1, 255,0 ,255);\n" +
		"    led(2, 0 ,255,255);\n" +
		"    led(3, 255,255,0);\n"  +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();
	}
	
	function ex2() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255, 0, 255);\n" +
		"    sleep(1);\n"            +
		"    led(0, 255, 255 ,0);\n" +
		"    sleep(1);\n"            +
		"    led(0, 0,255 , 255);\n" +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();
	}
	
	function ex3() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255,255,255);\n"+
		"    led(1, 255,255 ,255);\n" +
		"    led(2, 0 ,255,255);\n" +
		"    led(3, 0,255,0);\n"  +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();
	}
	
	function ex4() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255,255,255);\n"+
		"    led(1, 255,255 ,255);\n" +
		"    led(2, 0 ,255,255);\n" +
		"    led(3, 0,255,0);\n"  +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();
	}
	
	function ex5() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255,255,255);\n"+
		"    led(1, 255,255 ,255);\n" +
		"    led(2, 0 ,255,255);\n" +
		"    led(3, 0,255,0);\n"  +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();
	}
	
	function ex6() {
		var code_ex1 = 
		"int main(int argn, char* argv[])\n" +
		"{\n" +
		"    led(0, 255,255,255);\n"+
		"    led(1, 255,255 ,255);\n" +
		"    led(2, 0 ,255,255);\n" +
		"    led(3, 0,255,0);\n"  +
		"    return 0;\n" +
		"}\n"
		editor.setValue(code_ex1);
		editor.clearSelection();

	}

	function clean_console() {
		document.getElementById("console").innerHTML = " ";	
	};	
	
		function clean_error() {
		document.getElementById("error").innerHTML = " ";	
	};			

	function console_polling(){
		var xhr = new XMLHttpRequest();	
		xhr.open("get","console",false);
		xhr.send();
		var get = xhr.responseText;
		document.getElementById("console").innerHTML += "<p>"+ get+"<\p>";
	}; 
	//setInterval(console_polling, 1000);
	
	function error_polling(){
		var xhr = new XMLHttpRequest();	
		xhr.open("get","error",false);
		xhr.send();
		var get = xhr.responseText;
		document.getElementById("error").innerHTML += "<p>"+ get+"<\p>";
	}; 
	//setInterval(error_polling, 1000);
    
	function delay_refresh() {
		window.location.reload(); 
	}
	function page_refresh() {
		setTimeout('delay_refresh()',60000); 

	}
	
	window.onload=function() {
		var xhr = new XMLHttpRequest();	
		xhr.open("get","load",false);
		xhr.send();
		var versionlist = xhr.responseText;
		debuginf(versionlist);
		var list = versionlist.split(',');
		var html_list = "";
		debuginf(list);
		for (var index in list) {
			debuginf(list[index]);
			var name = list[index].split('.')[0];
			var ext  = list[index].split('.')[1];
			if (ext == 'jpg') {
				html_list += "<li><a href='#' onClick= configrations(event)>"+ 
				name +"</a></li>";
			}
		}
		document.getElementById("version_list").innerHTML = html_list;
		debuginf(list);
	}
	
</script>

<!-- API reference doc-->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="ModalLabel">API Reference Document</h3>
    </div>
    <div class="modal-body">
      <div class="panel-group" id="accordion">
          <div class="panel panel-default">
            <div class="panel-heading">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                <div class="alert alert-info" role="alert"><b>void led(int id, char r, char g, char b)</b></div>
                </a>
            </div>
            <div id="collapse1" class="panel-collapse collapse">
              <div class="panel-body">
                  <p>Functionality: Sleep for seconds</p>
                  <p>Argument: </p>
                  <p>id: The id of led can be 0-3</p>
                  <p>r: The red color of led</p>
                  <p>g: The greem color of led</p>
                  <p>b: The blue color of led</p>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
              <div class="alert alert-info" role="alert"><b>unsigned int sleep (unsigned int seconds)</b></div>
              </a>
            </div>
            <div id="collapse2" class="panel-collapse collapse">
              <div class="panel-body">
                  <p>Functionality: Sleep for seconds</p>
                  <p>Argument: </p>
                  <p>seconds The seconds for sleeping</p>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                <div class="alert alert-info" role="alert"><b>int usleep (int useconds)</b></div>
                </a>
            </div>
            <div id="collapse3" class="panel-collapse collapse">
              <div class="panel-body">
                <p>Functionality: Sleep for micro seconds</p>
                <p>Argument: </p>
                <p>usecods: The micro seconds for sleeping</p>
              </div>
            </div>
          </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                <div class="alert alert-info" role="alert"><b>int printf (char * format, ...)</b></div>
                </a>
            </div>
            <div id="collapse4" class="panel-collapse collapse">
              <div class="panel-body">
                  <p>Functionality: print the string to the console</p>
                  <p>Argument: </p>
                  <p>format:output format string</p>
              </div>
            </div>
          </div>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">close</button>
    </div>
</div>

</body>
</html>
